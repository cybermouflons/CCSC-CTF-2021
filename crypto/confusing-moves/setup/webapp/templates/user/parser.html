{% extends "_base.html" %}
{% import "bootstrap/wtf.html" as wtf %}
{% block content %}

<div>
  <h1>PGN Game Parser!</h1>
  <hr><br>
  <div class="d-flex justify-content-between align-items-center flex-wrap intro">
    <div>
      <p>Use the form below to submit a game for parsing. Benny will take a look as soon as possible!</p>
      <!--  NOTE TO BENNY: Man... your package name generator is so hard to wrap my head around.
        I have it here for reference <a href="/generator">generator</a>. I trust your crypto, surely enough it's uncrackable. -->
      <form class="form" role="form" method="post" action="">
        {{ form.csrf_token }}
        {{ wtf.form_errors(form, hiddens="only") }}

        <div class="row">
          <div class="col-lg-12">
            {{ wtf.form_field(form.pgn) }}
          </div>
        </div>

        <div class="col-lg-2 col-md-4 col-sm-4">
          <button class="btn btn-success" type="submit">Submit</button>
        </div>
      </form>
    </div>

    <img src="{{url_for('static', filename='images/benny.png')}}">
  </div>

  <hr><br>
  <br />
  <div>
    <div class="container mt-5 mb-5">
      <div class="row">
        <div class="col-md-12">
          <div class="d-flex flex-row justify-content-between align-items-center filters">
            <h6>Showing {{ game_count }} parsed games</h6>
          </div>
        </div>
      </div>
      <div class="row mt-1">
        {% for game in all_parsed_games %}
        <div class="col-md-4">
          <div class="p-card bg-white p-2 rounded px-3">
            <div class="d-flex align-items-between credits">
              {% if game.is_parsed %}
              <img src="{{url_for('static', filename='images/chess.png')}}" width="16px"><span
                class="text-black-50 ml-2">{{ game.moves_count }} moves</span>
              <span class="badge badge-primary py-1 ml-2 mt-2">#{{ game.id }}</span>
              <span class="badge badge-success py-1 ml-2 mt-2">success</span>

              {% else %}
              <span class="badge badge-danger py-1 ml-2 mt-2">fail</span>
              {% endif %}
            </div>
            {% if game.is_parsed %}
            <h5 class="mt-2">{{ game.white }} vs {{ game.black }}</h5>
            <span class="badge badge-primary py-1 mb-2">Event: {{ game.event }}</span>
            <span class="badge badge-danger py-1 mb-2">Site: {{ game.site }}</span>
            <span class="d-block mb-5">{{ game.moves }}</span>
            <div class="d-flex justify-content-between stats">
              <div><i class="fa fa-calendar-o"></i><span class="ml-2">{{ game.date }}</span></div>
              <div class="d-flex flex-row align-items-center">
                <div class="profiles">
                  <button class="btn btn-primary" data-toggle="modal" data-target="#parsedgame{{game.id}}">Logs</button>
                  <form class="inline" method="post" action="/game/delete">
                    <input type="hidden" name="gameid" value="{{ game.id }}"/>
                    <button class="btn btn-primary" type="submit">Delete</button>
                  </form>
                </div>
              </div>
            </div>
            {% else %}
            <h5 class="mt-2">Failed to parse PGN...</h5>
            <span class="d-block mb-5">You can still see the logs though...</span>
            <div class="d-flex justify-content-between stats">

              <div class="d-flex flex-row align-items-center">
                <div class="profiles">
                  <button class="btn btn-primary" data-toggle="modal" data-target="#parsedgame{{game.id}}">Logs</button>
                  <form class="inline" method="post" action="/game/delete">
                    <input type="hidden" name="gameid" value="{{ game.id }}"/>
                    <button class="btn btn-primary" type="submit">Delete</button>
                  </form>
                </div>
              </div>
            </div>
            {% endif %}

          </div>
        </div>

        <!-- Modal -->
        <div class="modal fade" id="parsedgame{{game.id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Logs</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <pre> {{game.logs}}</pre>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

  </div>
</div>

{% endblock %}

